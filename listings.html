<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Properties - Garrett Schaede | Grand Lake Luxury Properties</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #0d285e; /* Dark Blue */
            --secondary-color: #a87d3e; /* Gold/Bronze */
            --accent-color: #e0b66e; /* Lighter Gold */
            --text-dark: #2c3e50;
            --text-light: #ecf0f1;
            --background-light: #fdfaf6;
            --background-dark: #1a2c4a;
            --gradient-blue: linear-gradient(135deg, #0d285e 0%, #1a3a6b 100%);
            --gradient-gold: linear-gradient(135deg, #a87d3e 0%, #e0b66e 100%);
            --shadow-light: 0 5px 15px rgba(0,0,0,0.08);
            --shadow-medium: 0 10px 30px rgba(0,0,0,0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            line-height: 1.7;
            color: var(--text-dark);
            background: var(--background-light);
            overflow-x: hidden;
            padding-top: 100px;
        }
        
        /* --- All other existing CSS remains the same --- */
        .header, .nav-container, .logo, .nav-links, .footer, .page-header, .search-header, .pagination-container, .property-card, .property-details {
            /* Assume all your previous styles are here */
        }
        
        /* Added styles for new info on the card */
        .property-card-footer {
            padding: 0.75rem 1.5rem;
            background-color: #f8f9fa;
            border-top: 1px solid #eee;
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: auto; /* Pushes footer to the bottom */
        }
        .property-card-footer strong {
            color: #495057;
        }
        .property-card-link { text-decoration: none; color: inherit; display: flex; flex-direction: column; height: 100%; }
        
        /* Paste all your other CSS here to ensure the page looks correct */

    </style>
</head>
<body>
    <!-- Your existing header, mobile nav, page header, etc. go here -->

    <section id="listings-section" class="section">
        <div class="container" id="listings-container">
            
            <div class="search-header">
                <div class="total-found" id="total-found">Loading...</div>
                <div class="controls">
                    <label for="limit-select">Listings Per Page:</label>
                    <select id="limit-select">
                        <option value="15">15</option>
                        <option value="30">30</option>
                        <option value="45">45</option>
                    </select>
                    <select id="sort-select">
                        <option value="RecentlyUpdated">Recently Updated</option>
                        <option value="PriceLowHigh">Price: Low to High</option>
                        <option value="PriceHighLow">Price: High to Low</option>
                    </select>
                </div>
            </div>

            <div class="pagination-container" id="pagination-container-top"></div>
            <div class="listings-grid" id="listings-grid"></div>
            <div class="pagination-container" id="pagination-container-bottom"></div>

        </div>
    </section>

    <!-- Your existing footer goes here -->

    <script>
        // --- All previous JavaScript remains the same ---
        // (toggleMobileNav, scroll listener, setupControls, fetchAndDisplayListings, setupPagination)

        function displayListings(listings) {
            document.getElementById('total-found').textContent = `${totalListings} Matches Found`;
            const grid = document.getElementById('listings-grid');
            grid.innerHTML = '';

            // --- UPDATED SORTING LOGIC ---
            const REALTOR_OFFICE_KEY = '20211001133511324573000000';
            const REALTOR_NAME = 'Garrett Schaede';

            listings.sort((a, b) => {
                const isAFromOffice = a.ListOfficeKey === REALTOR_OFFICE_KEY;
                const isBFromOffice = b.ListOfficeKey === REALTOR_OFFICE_KEY;

                // 1. Primary Sort: By Office
                if (isAFromOffice && !isBFromOffice) return -1; // a (from the right office) comes first
                if (!isAFromOffice && isBFromOffice) return 1;  // b (from the right office) comes first

                // 2. Secondary Sort: By Agent Name (only if both are from the same office)
                if (isAFromOffice && isBFromOffice) {
                    const isAFromRealtor = a.ListAgentFullName && a.ListAgentFullName.includes(REALTOR_NAME);
                    const isBFromRealtor = b.ListAgentFullName && b.ListAgentFullName.includes(REALTOR_NAME);

                    if (isAFromRealtor && !isBFromRealtor) return -1; // a (by the target agent) comes first
                    if (!isAFromRealtor && isBFromRealtor) return 1;  // b (by the target agent) comes first
                }

                return 0; // maintain original API order for all others
            });

            if (!listings || listings.length === 0) {
                grid.innerHTML = `<p style="text-align: center; grid-column: 1 / -1;">No properties found.</p>`;
                return;
            }

            listings.forEach(listing => {
                const imageUrl = (listing.Media && listing.Media.length > 0) ? listing.Media[0].MediaURL : 'https://via.placeholder.com/400x250.png?text=No+Image';
                
                const modifiedDate = listing.ModificationTimestamp 
                    ? new Date(listing.ModificationTimestamp).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })
                    : 'N/A';

                const card = `
                    <a href="listing-details.html?listingKey=${listing.ListingKey}" class="property-card-link">
                        <div class="property-card">
                            <img src="${imageUrl}" alt="Image of ${listing.UnparsedAddress}" class="property-image">
                            <div class="property-details">
                                <div class="property-price">$${listing.ListPrice.toLocaleString()}</div>
                                <div class="property-address">${listing.UnparsedAddress}</div>
                                <div class="property-specs">
                                    <span><i class="fas fa-bed"></i> ${listing.BedroomsTotal || 0}</span>
                                    <span><i class="fas fa-bath"></i> ${listing.BathroomsTotalInteger || 0}</span>
                                    <span><i class="fas fa-ruler-combined"></i> ${listing.LivingArea?.toLocaleString() || 'N/A'} sqft</span>
                                </div>
                            </div>
                            <div class="property-card-footer">
                                <div><strong>Listing Office:</strong> ${listing.ListOfficeName || 'N/A'}</div>
                                <div><strong>Last Updated:</strong> ${modifiedDate}</div>
                            </div>
                        </div>
                    </a>
                `;
                grid.innerHTML += card;
            });
        }

        // --- All other JavaScript functions (setupControls, fetchAndDisplayListings, setupPagination) remain the same ---
    </script>
</body>
</html>
